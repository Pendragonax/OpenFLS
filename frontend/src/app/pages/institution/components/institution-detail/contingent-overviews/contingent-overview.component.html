<div class="contingent-overview">
  <mat-card class="overview-card">
    <mat-card-content>
      <app-contingent-overview-toolbar
        [years]="years"
        [selectedYear]="year"
        [hourTypes]="hourTypes"
        [selectedHourType]="selectedHourType"
        [exportDisabled]="tableData.length === 0"
        [loading]="isGenerating"
        (yearChanged)="onYearChanged($event)"
        (hourTypeChanged)="onHourTypeChanged($event)"
        (infoClicked)="openValueTypeInfoModal($event)"
        (exportClicked)="exportTable()">
      </app-contingent-overview-toolbar>

      <mat-divider class="table-divider"></mat-divider>

      <div class="table-wrapper contingent-table">
        @if (isGenerating) {
          <app-loading-spinner></app-loading-spinner>
        }
        @if (!isGenerating && isLoadedInitially) {
          <app-object-table
            [boldColumnIndices]="[0,1]"
            [exportFilename]="'ContingentOverview'"
            [columnFixedWidthFromIndex]="1"
            [data$]="data$"
            [header$]="header$"></app-object-table>
        }
      </div>

      <div class="contingent-cards">
        @if (isGenerating) {
          <app-loading-spinner></app-loading-spinner>
        }
        @if (!isGenerating && isLoadedInitially) {
          @for (row of tableData; track $index) {
            <div class="contingent-card">
              <div class="contingent-card__header">
                <div class="contingent-card__name">{{row[0]}}</div>
                <div class="contingent-card__total">{{tableHeader[1]}}: {{row[1]}}</div>
              </div>
              <div class="contingent-card__grid">
                @for (col of tableHeader.slice(2); track $index; let i = $index) {
                  <div class="contingent-card__item">
                    <span class="contingent-card__label">{{col}}</span>
                    <span class="contingent-card__sep">â€¢</span>
                    <span class="contingent-card__value">{{row[i + 2]}}</span>
                  </div>
                }
              </div>
            </div>
          }
        }
      </div>
    </mat-card-content>
  </mat-card>
</div>
